\packagename{RANDOM\_MATRIX}
\version{1.0.0}
\versiondate{6 March 2014}
\purpose{
This package generates a random sparse matrix of specified size and density in
compressed sparse column format. Either the pattern or both the pattern and
values can be generated. Both symmetric and unsymmetric matrices can be
generated, and structural non-degeneracy can optionally be ensured, and the
row indices can be sorted within columns.
}

\title{Generator of pseudo-random sparse matrices}
\author{Jonathan Hogg (STFC Rutherford Appleton Laboratory)}
\pkglang{C}
\spralmaketitle
\thispagestyle{firststyle}

\versionhistory
\begin{description}
\item[2014-03-06 Version 1.0.0] Initial release
\end{description}

%%%%%%%%%%%%%%%%%%%%%% installation %%%%%%%%%%%%%%%%%%%%%%

\section{Installation}
Please see the SPRAL install documentation.

%%%%%%%%%%%%%%%%%%%%%% how to use %%%%%%%%%%%%%%%%%%%%%%%%

\section{Usage overview}

\subsection{Calling sequences}

Access to the package requires inclusion of either \texttt{spral.h} (for the
entire \spral library) or \texttt{spral\_random\_matrix.h} (for just the relevant routines). i.e.

\begin{verbatim}
   #include "spral.h"
\end{verbatim}

\noindent
The following functions is available to the user:
\begin{itemize}
   \item {\tt random\_matrix\_generate()} generates a random matrix to the
      supplied specification.
\end{itemize}

\subsection{Seed initialization}
\label{random_matrix: seed initialization}
The random number generator's state is stored in the variable {\tt state}.
Before its first use, {\tt state} should be initialized by the user to an
initial seed value.

For convenience, the preprocessor macro \texttt{SPRAL\_RANDOM\_INITIAL\_SEED} has
been defined, and \texttt{state} may be declared and initialized using a statement of the
following form:
\begin{verbatim}
   int state = SPRAL_RANDOM_INITIAL_SEED;
\end{verbatim}

At any time the user may change the seed, for example to restore a previous
value. A call to \texttt{random\_matrix\_generate()} with the same parameters
and the same value of \texttt{state} will produces the same pseudo-random
matrix.

\subsection{Matrix types}
\label{random_matrix: matrix types}
The \texttt{enum spral\_matrix\_type} is defined as follows:
\begin{verbatim}
enum spral_matrix_type {
   // User doesn't wish to specify, use default behaviour
   SPRAL_MATRIX_UNSPECIFIED=0, 
   // Rectangular matrix, m!=n
   SPRAL_MATRIX_REAL_RECT=1,        SPRAL_MATRIX_CPLX_RECT=-1,
   // Square unsymmetric matrix m==n
   SPRAL_MATRIX_REAL_UNSYM=2,       SPRAL_MATRIX_CPLX_UNSYM=-2,
   // Symmetric/Hermitian positive-definite matrix
   SPRAL_MATRIX_REAL_SYM_PSDEF=3,   SPRAL_MATRIX_CPLX_HERM_PSDEF=-3,
   // Symmetric/Hermitian indefinite matrix
   SPRAL_MATRIX_REAL_SYM_INDEF=4,   SPRAL_MATRIX_CPLX_HERM_INDEF=-4,
   // Complex symmetric matrix      
                                    SPRAL_MATRIX_CPLX_SYM=-5,
   // Skew-symmetric matrix         
   SPRAL_MATRIX_REAL_SKEW=6,        SPRAL_MATRIX_CPLX_SKEW=-6
};
\end{verbatim}

For the purposes of this package, the behaviour is altered based on the matrix
type as follows:
\begin{itemize}
   \item The matrix dimensions must be consistent with the matrix type.
   \item For symmetric, Hermitian, and skew-symmetric matrices, only the
      entries in the lower triangle are returned. Otherwise all entries are
      returned.
   \item For positive-definite matrices, generated values are such that the
      matrix is diagonally dominant (and hence guarunteed to be
      positive-definite).
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%% argument lists %%%%%%%%%%%%%%%%%%%%%%%%

\section{Subroutines}

\subsection{\texttt{random\_matrix\_generate()}}
\textbf{
   To generate an $\texttt{m}\times \texttt{n}$ random matrix with \texttt{nnz}
non-zero entries, the following routine is provided.
}

\vspace*{0.1cm}
\noindent
\textbf{\texttt{
      \hspace*{0.3cm} int spral\_random\_matrix\_generate(int *state, enum spral\_matrix\_type matrix\_type, \\
       \hspace*{0.7cm} int m, int n, int nnz, int *ptr, int *row, double *val, int flags);
}}
\vspace*{0.3cm}

\noindent
A return value of \texttt{0} indicates success. For non-zero values, see Section~\ref{random_matrix: return values}.

\noindent
If \texttt{matrix\_type} specifies a
symmetric or skew symmetric matrix, only the lower half matrix will be returned
to the user.

\vspace*{-3mm}
\begin{description}

\item[\texttt{*state}] is the state of the pseudo-random number generator used.
   It should be initialized before the first use, as described in
   Section~\ref{random_matrix: seed initialization}.

\item[\texttt{matrix\_type}] specifies the matrix type to be generated, as
   described in Section~\ref{random_matrix: matrix types}.

\item[\texttt{m}] specifies the number of rows in the matrix.
{\bf Restriction:} {\tt m$\geq$1}.

\item[\texttt{n}] specifies the number of columns in the matrix.
{\bf Restriction:} {\tt n$\geq$1}, and consistent with \texttt{matrix\_type}.

\item[\texttt{nnz}] specifies the number of non-zeroes in the matrix.
{\bf Restriction:} {\tt nnz$\geq$1} (and \texttt{nnz}$\geq\min(\texttt{m},\texttt{n})$ if non-singularity requested, or positive-definite).

\item[\texttt{ptr[]}] must have size at least {\tt n+1}. On exit, {\tt ptr[j]}
   specifies the position in {\tt row[]}
   of the first entry in column {\tt j} and {\tt ptr[n]$=$nnz}.

\item[\texttt{row[]}] must have size at least {\tt nnz}. On exit, {\tt row[j]}
   specifies the row to which the {\tt j}-th entry belongs.

\item[\texttt{val[]}] may be \texttt{NULL}. If it is non-\texttt{NULL}, it must
   have size at least \texttt{nnz}. On exit, \texttt{val[j]} gives
   the value of the \texttt{j}-th entry. Entries are generated from a uniform
   distribution on the interval $[-1,1]$. In the positive-definite case only,
   diagonal entries are given a value equal to the sum of the off-diagonal
   entries in the row plus a value chosen uniformally at random from the
   interval $(0,1]$.

\item[\texttt{flags}] is the logical combination (i.e. bitwise-or) of
   the following possible values:
   \begin{description}
      \item[\texttt{SPRAL\_RANDOM\_MATRIX\_FINDEX}] if the entries of the arrays
         \texttt{ptr[]} and \texttt{row[]} should be numbered from should be
         numbered from 1 (i.e.\ Fortran indexing). If this flag is not
         set, these arrays will be numbered from 0 (i.e.\ C indexing).
      \item[\texttt{SPRAL\_RANDOM\_MATRIX\_NONSINGULAR}] if the generated matrix
         should be non-singular. The matrix is guaranteed to have a
         transversal of size $\min({\tt m}, {\tt n})$. In the symmetric or skew
         symmetric case this will be the natural diagonal. In the unsymmetric
         and rectangular cases a random matching is used. In the symmetric
         positive-definite case, this flag is ignored (it is treated as set).
         In all other cases, if this flag is not set, a maximum transversal is
         not guaranteed and the generated matrix may be structurally rank
         deficient.
      \item[\texttt{SPRAL\_RANDOM\_MATRIX\_SORT}] if the generated matrix should
         have its entries sorted to ascending row number within each column. If
         this flag is not set, entries may be returned in a random order within
         each column.
   \end{description}
   If none of the above options is desired, this value should be set to
   \texttt{0}.

\end{description}

%%%%%%%%%%%%%%%%%%%%%% Warning and error messages %%%%%%%%%%%%%%%%%%%%%%%%

\section{Return codes} \label{random_matrix: return values}

A successful call is indicated by a return value of zero.
A negative value is associated with an error message.

Possible negative values are:

\begin{description}
\item{$-$1} An allocation error has occurred.
\item{$-$2} An invalid value of {\tt matrix\_type} was supplied.
\item{$-$3} At least one of {\tt m}, {\tt n}, or {\tt nnz} was less than $1$.
\item{$-$4} The (in)equality of {\tt m} and {\tt n} was inconsistent with
   {\tt matrix\_type}.
\item{$-$5} A non-singular matrix was requested, but $\texttt{nnz}<\min(\texttt{m},\texttt{n})$.
\end{description}

\section{Method}

If structural non-singularity is requested, first $\min({\tt m}, {\tt n})$ entries are generated as follows:
\begin{description}
   \item[Unsymmetric or Rectangular] Random permutations of the rows and
      columns are generated. The first $\min({\tt m}, {\tt n})$ entries of
      these permutations are used to specify the entries of a maximum
      transversal.
   \item[Symmetric] The diagonal is added to the matrix explicitly.
\end{description}

The remaining non-zero entries are then assigned to columns uniformally at
random. In the symmetric case, a weighting is used in proportion to the number of
entries below the diagonal. If the selected column for a given non-zero is 
already full, a new random sample is drawn.

Once the number of entries in each column has been determined, and any required
maximum transversal inserted, row indices are determined uniformally at random.
Should a non-zero in that row already be present in the column, a new random
sample is drawn.

In all cases, values are drawn uniformally at random from the interval $(-1,1)$. In
the positive-definite case, a post-processing step sums the absolute values of
all the entries in each column and replaces the diagonal with this value.

%%%%%%%%%%%%%%%%%%%%%% EXAMPLE %%%%%%%%%%%%%%%%%%%%%%%%

\section{Example}

The following code generates a random $4 \times 5$ matrix with $8$ non-zeroes
that is non-singular.
\verbatiminput{examples/C/random_matrix.c}
This produces the following output:
\begin{verbatim}
Generating a 4 x 5 non-singular matrix with 8 non-zeroes
Generated matrix:
Matrix of undefined type, dimension 4x5 with 8 entries.
0:                                         -1.0744E-01   9.1000E-01
1:                             9.5364E-01                1.0912E-01
2:                                          1.1631E-01  -5.8957E-01
3:  -9.0631E-01                                          7.7313E-01
\end{verbatim}

\begin{funders}
   \funder{epsrc}{Funded by EPSRC grant EP/J010553/1}
\end{funders}
